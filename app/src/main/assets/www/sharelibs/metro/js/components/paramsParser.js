!function(){var e=function(e,t,n){var s="t_tssparams_manage",i="t_tss_params";this.isInit=!1;var a=function(){},l=function(){},o=this;this.init=function(e,t){this.isInit||(this.isInit=!0,this.tableSchemas=n.defineTables([{name:s,schema:{version:"TEXT",business_id:"TEXT",cre_time:"DATE",upd_time:"DATE"}},{name:i,schema:{tag:"TEXT",value:"TEXT",desc:"TEXT",edit_type:"TEXT",sel_data:"TEXT",cre_time:"DATE",upd_time:"DATE"}}]),n.schemaSync(),a=this.tableSchemas[s],l=this.tableSchemas[i],o.loadParamsJson(e,t))},this.loadParamsJson=function(s,i){e.ajax({url:s,dataType:"json",success:function(e){t.isNull(e)&&(console.error("加载params.json失败！data == null!"),i(!1));var s=a.all().order("cre_time",!1).limit(1);s.list(function(s){var l=null,r=!1;if(t.isNull(s)||s.length<=0){var c={version:e.VERSION,business_id:e.BUSINESSID,cre_time:new Date};l=new a(c),n.saveOrUpdate(l),console.log("新增tss参数控制，将更新参数列表！"),r=!0}else{var u=s[0].version;t.isNull(u)?(s[0].version=e.VERSION,s[0].business_id=e.BUSINESSID,t.isNull(s[0].cre_time)&&(s[0].cre_time=new Date),s[0].upd_time=new Date,n.saveOrUpdate(s[0]),console.log("无法获得tss参数版本，将更新参数列表！"),r=!0):u<e.VERSION&&(s[0].version=e.VERSION,s[0].business_id=e.BUSINESSID,s[0].upd_time=new Date,n.saveOrUpdate(s[0]),console.log("参数版本更新["+u+","+e.VERSION+"]，将更新参数列表！"),r=!0)}r?o.updateParams(e.PARAMS,i):i()})},error:function(e){console.error("加载params.json失败！"+JSON.stringify(e)),i(!1)}})},this.updateParams=function(e,t){console.log("开始更新参数列表!"),console.log("开始参数列表清理...!");var s=l.all();s.list(function(e){e.forEach(function(e){n.remove(e)})});var s=l.all();s.list(function(s){console.log("开始参数列表清理完成!length:"+s.length),e.forEach(function(e){var t={tag:e.tag,value:e.value,desc:e.desc,edit_type:e.edittype,sel_data:e.seldata,cre_time:new Date},e=new l(t);console.log("开始设置参数["+e.tag+"]:"+JSON.stringify(t)),n.saveOrUpdate(e,function(){l.findBy("tag",e.tag,function(n){null==n?console.log("开始设置参数["+e.tag+"],参数失败!"):console.log("设置参数["+e.tag+"]成功:"+JSON.stringify(t))})})}),t()})},this.getTSSParamsManage=function(e){var n=a.all().order("cre_time",!1).limit(1);n.list(function(n){return t.isNull(n)||n.length<=0?void e(null):void e(rslt[0])})},this.getTSSParams=function(e){var t=l.all();t.list(function(t){e(t)})},this.getTSSParam=function(e,n){var s=l.all().filter("tag","=",e);s.list(function(e){return t.isNull(e)||t.isNull(e[0])?void n(null):void n(e[0])})}};define(["jquery","utils","dbManager"],function(t,n,s){return new e(t,n,s)})}();