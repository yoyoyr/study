define(["jquery"],function(a){return{KBTYPE:{AMOUNT:"amount",AMOUNT2:"amount-with-two-btns",WCNO:"weichart-number",NUMBER:"number-keyboard"},KEY:{CLEAR:-2,BACKSPACE:-1,CONFIRM:-3,SCAN:-4},kb:a('<table class="amount-key-board" width="100%"><tr><td><a data-value="1">1</a></td><td><a data-value="2">2</a></td><td><a data-value="3">3</a></td></tr><tr><td><a data-value="4">4</a></td><td><a data-value="5">5</a></td><td><a data-value="6">6</a></td></tr><tr><td><a data-value="7">7</a></td><td><a data-value="8">8</a></td><td><a data-value="9">9</a></td></tr><tr><td><a data-value="-2">清零</a></td><td><a data-value="0">0</a></td><td><a data-value="-1" class="backspace">&nbsp;</a></td></tr><tr><td class="btns" colspan="3"><a class="confirm" data-value="-3">开始刷卡</a></td></tr></table>'),kbwc:a('<table class="amount-key-board" width="100%"><tr><td><a data-value="1">1</a></td><td><a data-value="2">2</a></td><td><a data-value="3">3</a></td></tr><tr><td><a data-value="4">4</a></td><td><a data-value="5">5</a></td><td><a data-value="6">6</a></td></tr><tr><td><a data-value="7">7</a></td><td><a data-value="8">8</a></td><td><a data-value="9">9</a></td></tr><tr><td><a data-value="-2">清零</a></td><td><a data-value="0">0</a></td><td><a data-value="-1" class="backspace">&nbsp;</a></td></tr><tr><td colspan="3"><a class="btn-green" data-value="-3">手动输码</a><a class="btn-green-deep" data-value="-4">扫一扫</a></td></tr></table>'),init:function(t,n,e){var d=this,u=d.kb;u.find("a").off("touchend").on("touchend",function(){var t=parseInt(a(this).attr("data-value"));d._updataValue(d.KBTYPE.AMOUNT,t,n,e)}),t.html(u)},initWcKb:function(t,n,e,d){var u=this,i=u.kb;i.find(".btns").html('<a class="btn-green" data-value="-3">手动输码</a><a class="btn-green-deep" data-value="-4">扫一扫</a>'),i.find("a").off("touchend").on("touchend",function(){var t=parseInt(a(this).attr("data-value"));u._updataValue(u.KBTYPE.AMOUNT2,t,n,e,d)}),t.html(i)},init4BtKb:function(t,n,e,d,u,i){var l=this,r=l.kb;r.find(".btns").html('<a class="consume" data-value="-3"></a><a class="postong" data-value="-3"></a><a class="wechat" data-value="-3"></a><a class="alipay" data-value="-3"></a>'),r.find("a").off("touchend").on("touchend",function(){var t=parseInt(a(this).attr("data-value"));l._updataValue(l.KBTYPE.AMOUNT2,t,n,e,d,u,i)}),t.html(r)},initWcNoKb:function(t,n,e){var d=this,u=d.kb;u.find(".btns").html('<a class="confirm" data-value="-3">确认</a>'),u.find("a").off("touchend").on("touchend",function(){var t=parseInt(a(this).attr("data-value"));d._updataValue(d.KBTYPE.WCNO,t,n,e)}),t.html(u)},initWcNoKb2:function(t,n,e,d){var u=this,i=u.kb;i.find(".btns").html('<a class="btn-green" data-value="-3">确认</a><a class="btn-green-deep" data-value="-4">扫一扫</a>'),i.find("a").off("touchend").on("touchend",function(){var t=parseInt(a(this).attr("data-value"));u._updataValue(u.KBTYPE.WCNO,t,n,e,d)}),t.html(i)},initNoKb:function(t,n,e){var d=this,u=d.kb;u.find(".btns").html('<a class="confirm" data-value="-3">确认</a>'),u.find("a").off("touchend").on("touchend",function(){var t=parseInt(a(this).attr("data-value"));d._updataValue(d.KBTYPE.NUMBER,t,n,e)}),t.html(u)},_updataValue:function(a,t,n,e,d){var u=n.is("input"),i=u?n.val():n.text(),l=n.attr("maxlength");if(t==this.KEY.CLEAR)u?n.val(""):n.text("0.00");else if(t==this.KEY.BACKSPACE)u?n.val(this._pullNo(a,i)):n.text(this._pullNo(a,i));else if(t==this.KEY.CONFIRM)null!=e&&e(i);else if(t==this.KEY.SCAN)null!=d&&d(parseFloat(i));else if(t>=0&&t<=9){if(void 0!=l&&i.length>=l)return!1;u?n.val(this._pushNo(a,i,t.toString())):n.text(this._pushNo(a,i,t.toString()))}},_pushNo:function(a,t,n){if(a==this.KBTYPE.WCNO){var e=t.replace(/\s/g,"");return e.length>=18?t:(0!=e.length&&e.length%4==0&&e.length<=12&&(t+="  "),t+n)}if(a==this.KBTYPE.NUMBER)return t+n;var d=this._multiply100(t);if(!(d.length>=12)){var u=this._divide100(d+n);return this._removeStartWith0(u)}},_pullNo:function(a,t){if(a==this.KBTYPE.WCNO){t=t.trim();var n=t;return n=n.substring(0,n.length-1),n.trim()}if(a==this.KBTYPE.NUMBER){var n=t;return n=n.substring(0,n.length-1)}var n=this._multiply100(t);n=n.substring(0,n.length-1);var e=this._divide100(n);return this._addStartWith0(e)},_divide100:function(a){var t=a.length;return a.substring(0,t-2)+"."+a.substring(t-2)},_multiply100:function(a){var t=a.indexOf("."),n=a.substring(0,t)+a.substring(t+1);return n},_removeStartWith0:function(a){var t=a.indexOf(".");if(t>0){var n=parseInt(a.substring(0,t));return n.toString()+a.substring(t)}},_addStartWith0:function(a){var t=a.indexOf(".");return 0==t?"0"+a:a}}});