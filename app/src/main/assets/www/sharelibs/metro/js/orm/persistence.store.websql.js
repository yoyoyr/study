try{window||(window={})}catch(e){window={},exports.console=console}var persistence=window&&window.persistence?window.persistence:{};persistence.store||(persistence.store={}),persistence.store.websql={},persistence.store.websql.config=function(n,e,t,o){var r=null;if(n.transaction=function(n){if(!r)throw new Error("No ongoing database connection, please connect first.");r.transaction(n)},n.db=n.db||{},n.db.implementation="unsupported",n.db.conn=null,window&&window.openDatabase)n.db.implementation="html5";else if(window&&window.google&&google.gears)n.db.implementation="gears";else try{openDatabaseSync&&(n.db.implementation="html5-sync")}catch(c){}if(n.db.html5={},n.db.html5.connect=function(e,t,o){var r={},c=openDatabase(e,"1.0",t,o);return r.transaction=function(e){return c.transaction(function(t){return e(n.db.html5.transaction(t))})},r},n.db.html5.transaction=function(e){var t={};return t.executeSql=function(t,o,r,c){n.debug&&console.log(t,o),e.executeSql(t,o,function(n,e){if(r){for(var t=[],o=0;o<e.rows.length;o++)t.push(e.rows.item(o));r(t)}},c)},t},n.db.html5Sync={},n.db.html5Sync.connect=function(e,t,o){var r={},c=openDatabaseSync(e,"1.0",t,o);return r.transaction=function(e){return c.transaction(function(t){return e(n.db.html5Sync.transaction(t))})},r},n.db.html5Sync.transaction=function(e){var t={};return t.executeSql=function(t,o,r,c){null==o&&(o=[]),n.debug&&console.log(t,o);var i=e.executeSql(t,o);if(i&&r){for(var a=[],s=0;s<i.rows.length;s++)a.push(i.rows.item(s));r(a)}},t},n.db.gears={},n.db.gears.connect=function(e){var t={},o=google.gears.factory.create("beta.database");return o.open(e),t.transaction=function(e){e(n.db.gears.transaction(o))},t},n.db.gears.transaction=function(e){var t={};return t.executeSql=function(t,o,r,c){n.debug&&console.log(t,o);var i=e.execute(t,o);if(r){for(var a=[];i.isValidRow();){for(var s={},l=0;l<i.fieldCount();l++)s[i.fieldName(l)]=i.field(l);a.push(s),i.next()}r(a)}},t},n.db.connect=function(e,t,o){return"html5"==n.db.implementation?n.db.html5.connect(e,t,o):"html5-sync"==n.db.implementation?n.db.html5Sync.connect(e,t,o):"gears"==n.db.implementation?n.db.gears.connect(e):void 0},n.store.websql.sqliteDialect={createTable:function(e,t){for(var o=n.typeMapper,r="CREATE TABLE IF NOT EXISTS `"+e+"` (",c=[],i=0;i<t.length;i++){var a=t[i];c.push("`"+a[0]+"` "+o.columnType(a[1])+(a[2]?" "+a[2]:""))}return r+=c.join(", "),r+=")"},createIndex:function(n,e,t){return t=t||{},"CREATE "+(t.unique?"UNIQUE ":"")+"INDEX IF NOT EXISTS `"+n+"__"+e.join("_")+"` ON `"+n+"` ("+e.map(function(n){return"`"+n+"`"}).join(", ")+")"}},n.store.sql.config(n,n.store.websql.sqliteDialect),r=n.db.connect(e,t,o),!r)throw new Error("No supported database found in this browser.")};try{exports.persistence=persistence}catch(e){}